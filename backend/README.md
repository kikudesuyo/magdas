# MAGDAS Web システム Backend 開発

## リポジトリの説明

EE-index の解析を行う。
任意の時間幅で EE-index の取得とプロットを目的とする。

### 観測点情報

<details>
<summary>観測点情報</summary>

```Python
#stations = {"STATION": ["gm_lat", "gg_lon", "time_diff" ]}
stations = {
    "AAB": [0.18, 38.77, 2.585333333333333],
    "ABU": [-1.53, 7.39, 0.49266666666666664],
    "AMA": [21.11, 129.33, 8.622],
    "ANC": [0.77, 282.85, -5.143333333333333],
    "BCL": [-0.66, 105.71, 7.047333333333333],
    "BKL": [-15.13, 102.31, 6.820666666666667],
    "CDO": [-1.1, 124.63, 8.308666666666667],
    "CEB": [2.53, 123.91, 8.260666666666667],
    "DAV": [-1.02, 125.4, 8.36],
    "DAW": [-21.91, 130.92, 8.728],
    "EUS": [-3.64, 321.57, -2.562000000000003],
    "EWA": [21.67, 202, -10.5333333333333],
    "GSI": [-7.53, 97.61, 6.507333333333333],
    "HLN": [16.86, 121.55, 8.103333333333333],
    "ICA": [-1.56, 284.26, -5.04933333333333],
    "ILR": [-1.82, 4.68, 0.312],
    "KRT": [5.69, 32.32, 2.1546666666666665],
    "LAG": [-3.04, 3.27, 0.218],
    "LGZ": [3.54, 123.74, 8.249333333333333],
    "LKW": [-2.32, 99.78, 6.652],
    "LWA": [-16.19, 104.06, 6.937333333333333],
    "MND": [-6.91, 124.84, 8.322666666666666],
    "MUT": [6.79, 121.02, 8.068],
    "NAB": [-10.65, 36.48, 2.432],
    "PRP": [-12.38, 119.4, 7.96],
    "SCN": [-12.11, 100.3, 6.6866666666666665],
    "TGG": [10.26, 121.76, 8.117333333333334],
    "TIR": [-0.37, 76.95, 5.13],
    "YAP": [1.49, 138.08, 9.205333333333333],
}
```

</details>

## 使用技術

言語: Python
フレームワーク: FastAPI

## 環境構築

### Storage ディレクトリ

#### MAGDAS データの準備

生データ(.mgd 形式)を準備してください。
backend/Storage/ee_index/AAB/Min/1999/AAB_MIN_199911300000.mgd

#### KP データ

KP データは Storage ディレクトリ内にあります。
Storage/ee_idex/kpdata.csv

### 仮想環境の作成

```bash
python -m venv .venv
```

### 仮想環境の有効化

```bash
#Windows環境
source .venv/Scripts/activate
#Unix環境
source .venv/bin/activate
```

### パッケージのインストール

```bash
pip install -r requirements.txt
```

### 実行方法

invoke モジュールを使用

```bash
#ファイルの実行
inv run 'your-filename'
#サーバー実行
inv server
#テストファイルの実行
inv test 'test-file'
#全てのテストファイルの実行
inv test-all
```

## 全体規則

#### 機能同士が密結合にならないコーディングを意識すること

目的としては主に 2 つ

1. テストのしやすさ、保守のしやすさ
1. 柔軟性の確保

ただし。インターフェース層を用意するのは開発コストが高くなるため、DI 等は行わない。

#### 計算時間を意識したコーディングを行うこと

- 重複した計算をなるべく減らす
- 計算量を意識したコーディング

#### クリーンアーキテクチャを意識したコーディングを行うこと

以下のルールに従って開発を行ってください。これにより、統一された設計・実装が可能になります。

- domain 層でデータ構造の定義
  - ※むやみに増やさず、現状の構造で対応出来ない場合のみ追加すること
- usecase 層でロジックの追加
- handler 層で API を追加
  - 1 つのハンドラにつき 1 つのファイルを作成してください。

## 命名規則

以下の Prefix/Suffix を守って開発を行ってください。（随時追記予定）

| 用途                 | Prefix/Suffix |
| -------------------- | ------------- |
| 計算関数             | `calc_`       |
| インスタンス生成関数 | `create_`     |
| 計算関連ファイル     | `calc_`       |
| プロット関連ファイル | `plot_`       |
| ハンドラファイル     | `_handler`    |
